<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß</title>
</head>
<body>
    <h1>üìå ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß</h1>

    <label for="customer-name">‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:</label>
    <input type="text" id="customer-name" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
    
    <button onclick="bookQueue()">üìå ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß</button>
    <button onclick="cancelQueue()">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏¥‡∏ß (‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏≠‡∏≤‡∏≠‡∏≠‡∏Å)</button>

    <h2>üî¢ ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏¥‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: <span id="current-queue">-</span></h2>

    <h3>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á</h3>
    <ul id="queue-list"></ul>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycby-KwfxYFeKrCfrIRI15liGCIODY6SfM0okPUisz-9bgKcb-0WcFXnIHExMoyUo2_Q/exec";

        async function bookQueue() {
            const customerName = document.getElementById("customer-name").value.trim();
            if (!customerName) {
                alert("‚ùó ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß");
                return;
            }

            const res = await fetch(`${API_URL}?action=bookQueue&name=${encodeURIComponent(customerName)}`);
            const data = await res.json();
            document.getElementById("current-queue").textContent = data.queueNo;
            alert(`‚úÖ ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ñ‡∏∏‡∏ì ${customerName} ‡πÑ‡∏î‡πâ‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏µ‡πà ${data.queueNo}`);
            loadQueues();
        }

        async function cancelQueue() {
            await fetch(`${API_URL}?action=cancelQueue`);
            document.getElementById("current-queue").textContent = "-";
            alert("‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏¥‡∏ß‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
            loadQueues();
        }

        async function loadQueues() {
            const res = await fetch(`${API_URL}?action=getQueues`);
            const queues = await res.json();
            const queueList = document.getElementById("queue-list");
            queueList.innerHTML = "";
            queues.forEach(queue => {
                const formattedTime = formatThaiTime(queue.timestamp); // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢
                const li = document.createElement("li");
                li.textContent = `‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏µ‡πà ${queue.queueNo} - ‡∏ä‡∏∑‡πà‡∏≠: ${queue.name} - ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${queue.status} - ‡πÄ‡∏ß‡∏•‡∏≤: ${formattedTime}`;
                queueList.appendChild(li);
            });
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á timestamp ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢ (GMT+7)
        function formatThaiTime(timestamp) {
            if (!timestamp) return "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ß‡∏•‡∏≤";
            const date = new Date(timestamp);
            return new Intl.DateTimeFormat('th-TH', {
                year: 'numeric', month: 'long', day: 'numeric',
                hour: '2-digit', minute: '2-digit', second: '2-digit',
                timeZone: 'Asia/Bangkok'
            }).format(date);
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å 2 ‡∏ô‡∏≤‡∏ó‡∏µ
        setInterval(loadQueues, 120000);

        loadQueues();
    </script>
</body>
</html>
